<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <script>
    const socket = io('http://localhost:8001'); // Connect to the server

    let senderId = '';
    let receiverId = '';

    // Register the sender and receiver IDs and the socket
    function setIds() {
      senderId = document.getElementById('senderId').value;
      receiverId = document.getElementById('receiverId').value;

      // Register the sender with the socket server
      socket.emit('register', senderId); // Send userId to the server to register the socket
    }

    // Listen for incoming messages from the server
    socket.on('receiveMessage', (message) => {
      const messageContainer = document.getElementById('messages');
      messageContainer.innerHTML += `<p><strong>${message.sender}:</strong> ${message.message}</p>`;
    });

    // Function to send a message
    function sendMessage() {
      const message = document.getElementById('message').value;
      setIds();  // Get sender and receiver IDs

      if (senderId && receiverId && message) {
        // Emit the 'sendMessage' event to the server
        socket.emit('sendMessage', { senderId, receiverId, message });

        // Display the sent message on the sender's screen
        const messageContainer = document.getElementById('messages');
        messageContainer.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
        document.getElementById('message').value = '';  // Clear input field
      } else {
        alert('Please fill in sender ID, receiver ID, and message');
      }
    }
  </script>
</head>
<body>
  <div>
    <input type="text" id="senderId" placeholder="Sender ID" />
    <input type="text" id="receiverId" placeholder="Receiver ID" />
    <textarea id="message" placeholder="Enter message"></textarea>
    <button onclick="sendMessage()">Send Message</button>
  </div>

  <div id="messages"></div>
</body>
</html>
